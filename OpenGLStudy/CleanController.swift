//
//  ViewController.swift
//  OpenGLStudy
//
//  Created by KKING on 2017/12/18.
//  Copyright © 2017年 KKING. All rights reserved.
//

import UIKit

class CleanController: UIViewController {
    
    var mapView = RotaMapView()
    

    override func viewDidLoad() {
        super.viewDidLoad()
        
        view.addSubview(mapView)
        mapView.center = view.center
        
        let fileName = Bundle.main.path(forResource: "data", ofType: "plist")
        let dataArr = NSArray(contentsOfFile: fileName!)
        print(dataArr?.count)
        
        do {
            let mapJson = [
                ["Header":
                    [
                        "Seq":0,
                        "Stamp":1513595809298993608,
                        "FrameID":"map"
                    ],
                 "Info":[
                    "MapLoadTime":1513595809298993608,
                    "Resolution":0.05,
                    "Width":34,
                    "Height":34,
                    "Origin":
                        [
                            "Position":["X":-1.05,"Y":-1.05,"Z":0],
                            "Orientation":["X":0,"Y":0,"Z":0,"W":1]
                    ]],
                 "DataLength":1156,
                 "Data":[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,75,75,75,75,75,52,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,75,75,75,55,4,4,4,4,75,75,75,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,75,75,43,4,4,4,4,4,4,4,4,4,10,75,75,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,52,75,75,4,4,4,4,4,4,4,4,4,4,4,4,4,75,75,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,75,75,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,75,75,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,75,75,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,75,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,75,74,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,75,75,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,52,75,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,75,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,75,43,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,75,-1,-1,-1,-1,-1,-1,-1,-1,-1,75,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,75,75,75,-1,-1,-1,-1,-1,-1,52,75,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,75,75,-1,-1,-1,-1,-1,75,37,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,73,75,-1,-1,-1,-1,75,10,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,75,-1,-1,-1,75,10,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,73,75,-1,-1,75,10,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,75,75,-1,75,15,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,75,-1,-1,75,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,75,75,-1,75,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,75,-1,75,10,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,75,-1,-1,75,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,75,-1,-1,75,74,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,75,-1,-1,-1,75,75,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,75,-1,-1,-1,-1,75,10,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,75,-1,-1,-1,-1,-1,75,75,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,75,-1,-1,-1,-1,-1,-1,75,75,10,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,74,75,-1,-1,-1,-1,-1,-1,-1,-1,75,75,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,75,75,-1,-1,-1,-1,-1,-1,-1,-1,-1,75,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,75,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,75,75,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,75,75,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,75,75,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,75,75,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,75,26,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,75,75,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,55,75,75,4,4,4,4,4,4,4,4,4,4,4,4,4,4,75,75,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,75,75,4,4,4,4,4,4,4,4,4,4,4,4,75,75,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,75,75,75,21,4,4,4,4,4,4,65,75,75,64,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,75,75,75,75,75,75,75,75,75,61,-1,-1,-1,-1,-1,-1,-1,-1]
                ] as [String : Any]
            ]
            
            let data = try JSONSerialization.data(withJSONObject: mapJson, options: .prettyPrinted)
            let json = JSON(data: data)
            
            drawMap(json: json)
        }catch let error {
            print(error)
        }
    }
    
    func drawMap(json: JSON) {
        
        let width = json[0]["Info"]["Width"]
        let height = json[0]["Info"]["Height"]

        mapView.bounds = CGRect(x: 0, y: 0, width: CGFloat(width.floatValue), height: CGFloat(height.floatValue))
        
        //draw point
        print("\(json[0]["Data"].arrayValue)")
        
        let oldArr = json[0]["Data"].arrayValue

        
        var newArr = Array(repeating:Array(repeating:Int(), count:width.intValue), count:height.intValue)
        
        
        for i in 0..<height.intValue {
            for j in 0..<width.intValue {
                newArr[i][j] = oldArr[i*json[0]["Info"]["Width"].intValue + j].intValue
            }
        }
        
        print("newArr:\(newArr)")
        
        mapView.dataArr = newArr
        mapView.setNeedsDisplay()
    }
    
    
    
//    override func touchesBegan(_ touches: Set<UITouch>, with event: UIEvent?) {
//        present(GLViewController(), animated: true, completion: nil)
//    }
    
}

